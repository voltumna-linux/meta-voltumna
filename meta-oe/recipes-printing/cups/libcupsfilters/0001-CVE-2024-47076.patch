From 5f950f6a52c7453d76fb30dbc8d66bbc1cc682a3 Mon Sep 17 00:00:00 2001
From: Zdenek Dohnal <zdohnal@redhat.com>
Date: Thu, 26 Sep 2024 23:09:29 +0200
Subject: [PATCH] CVE-2024-47076

cfGetPrinterAttributes5(): Validate response attributes before return

The destination can be corrupted or forged, so validate the response
to strenghten security measures.

CVE: CVE-2024-47076
Upstream-Status: Backport [https://github.com/OpenPrinting/libcupsfilters/commit/95576ec3d20c109332d14672a807353cdc551018]

(cherry picked from commit 95576ec3d20c109332d14672a807353cdc551018)
Signed-off-by: Ankur Tyagi <ankur.tyagi85@gmail.com>
---
 cupsfilters/ipp.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/cupsfilters/ipp.c b/cupsfilters/ipp.c
index a0814ae5..994c8dac 100644
--- a/cupsfilters/ipp.c
+++ b/cupsfilters/ipp.c
@@ -452,6 +452,14 @@ cfGetPrinterAttributes5(http_t *http_printer,
 	    ippDelete(response2);
 	  }
 	}
+
+	// Check if the response is valid
+	if (!ippValidateAttributes(response))
+	{
+	  ippDelete(response);
+	  response = NULL;
+	}
+
 	if (have_http == 0) httpClose(http_printer);
 	if (uri) free(uri);
 	return (response);
