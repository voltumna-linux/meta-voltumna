From a95f977f5d809915ec4b14836d2b5b7f5e74881e Mon Sep 17 00:00:00 2001
From: Matthew Fernandez <matthew.fernandez@gmail.com>
Date: Wed, 24 Jul 2024 15:02:06 +0800
Subject: [PATCH] gvc: detect plugin installation failure and display an error

Gitlab: fixes #2441
Reported-by: GJDuck

CVE: CVE-2023-46045
Upstream-Status: Backport [https://gitlab.com/graphviz/graphviz/-/commit/a95f977f5d809915ec4b14836d2b5b7f5e74881e]

Signed-off-by: Yogita Urade <yogita.urade@windriver.com>
---
 lib/gvc/gvconfig.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/gvc/gvconfig.c b/lib/gvc/gvconfig.c
index ea0d81b..1eccc70 100644
--- a/lib/gvc/gvconfig.c
+++ b/lib/gvc/gvconfig.c
@@ -189,6 +189,10 @@ static int gvconfig_plugin_install_from_config(GVC_t * gvc, char *s)
	do {
	    const char *api = token(&nest, &s);
	    const api_t gv_api = gvplugin_api(api);
+	    if (gv_api == (api_t)-1) {
+		agerr(AGERR, "config error: %s %s not found\n", package_path, api);
+		return 0;
+	    }
	    do {
		if (nest == 2) {
		    type = token(&nest, &s);
--
2.25.1
