From 23a122eddaa28165a6c219000adcc31ff9a8a698 Mon Sep 17 00:00:00 2001
From: "zhang.jiujiu" <282627424@qq.com>
Date: Tue, 7 Dec 2021 22:37:02 +0800
Subject: [PATCH] fix memory leaks

Upstream-Status: Backport [https://github.com/openEuler-BaseService/yajl/commit/23a122eddaa28165a6c219000adcc31ff9a8a698]
CVE: CVE-2023-33460
Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 src/yajl_tree.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/yajl_tree.c b/src/yajl_tree.c
index 3d357a3..a71167e 100644
--- a/src/yajl_tree.c
+++ b/src/yajl_tree.c
@@ -445,6 +445,9 @@ yajl_val yajl_tree_parse (const char *input,
              YA_FREE(&(handle->alloc), internal_err_str);
         }
         yajl_free (handle);
+	//If the requested memory is not released in time, it will cause memory leakage
+	if(ctx.root)
+	     yajl_tree_free(ctx.root);
         return NULL;
     }
 
-- 
2.25.1

