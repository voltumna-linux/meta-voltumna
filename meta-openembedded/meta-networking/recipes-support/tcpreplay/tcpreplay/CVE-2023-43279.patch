From 3164a75f2660a5c3537feff9fd8751346cf5ca57 Mon Sep 17 00:00:00 2001
From: Gabriel Ganne <gabriel.ganne@gmail.com>
Date: Sun, 21 Jan 2024 09:16:38 +0100
Subject: [PATCH] add check for empty cidr

This causes tcprewrite to exit with an error instead of crashing.

Fixes: #824

Upstream-Status: Backport
CVE: CVE-2023-43279

Reference to upstream patch:
https://github.com/appneta/tcpreplay/pull/860/commits/963842ceca79e97ac3242448a0de94fb901d3560

Signed-off-by: Gabriel Ganne <gabriel.ganne@gmail.com>
Signed-off-by: Jiaying Song <jiaying.song.cn@windriver.com>
---
 src/common/cidr.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/common/cidr.c b/src/common/cidr.c
index 687fd04..9afbfec 100644
--- a/src/common/cidr.c
+++ b/src/common/cidr.c
@@ -249,6 +249,10 @@ parse_cidr(tcpr_cidr_t **cidrdata, char *cidrin, char *delim)
     char *network;
     char *token = NULL;
 
+    if (cidrin == NULL) {
+        errx(-1, "%s", "Unable to parse empty CIDR");
+    }
+
     mask_cidr6(&cidrin, delim);
 
     /* first iteration of input using strtok */
-- 
2.25.1

