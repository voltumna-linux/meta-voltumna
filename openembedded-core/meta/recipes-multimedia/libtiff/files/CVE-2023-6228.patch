From 1e7d217a323eac701b134afc4ae39b6bdfdbc96a Mon Sep 17 00:00:00 2001
From: Su_Laus <sulau@freenet.de>
Date: Sat, 9 Sep 2023 15:45:47 +0200
Subject: [PATCH] Check also if codec of input image is available,
 independently from codec check of output image and return with error if not.
 Fixes #606.

Upstream-Status: Backport [https://gitlab.com/libtiff/libtiff/-/commit/1e7d217a323eac701b134afc4ae39b6bdfdbc96a]
CVE: CVE-2023-6228
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 tools/tiffcp.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index 007bd05..d2f7b66 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -628,6 +628,8 @@ tiffcp(TIFF* in, TIFF* out)
 	else
 		CopyField(TIFFTAG_COMPRESSION, compression);
 	TIFFGetFieldDefaulted(in, TIFFTAG_COMPRESSION, &input_compression);
+	if (!TIFFIsCODECConfigured(input_compression))
+	    return FALSE;
 	TIFFGetFieldDefaulted(in, TIFFTAG_PHOTOMETRIC, &input_photometric);
 	if (input_compression == COMPRESSION_JPEG) {
 		/* Force conversion to RGB */
-- 
2.25.1

